
@{
    ViewData["Title"] = "实验室安全教育在线-添加学生";
    Layout = "~/Views/Shared/_BackEnd_Layout.cshtml";
}

<div class=" bc-clr-white padding-10px  border-little-grey-all" data-height-all>
    <h4 class="border-light-down font-size-15 font-weight-500 padding-bottom-10px ">
        <span class=" glyphicon glyphicon-plus"></span> 添加学生参加考试
    </h4>
    <form class="form-horizontal margin-top-30px">
        <div class="form-group">
            <label for="StudentId" class="col-sm-2  control-label">
                <span class="glyphicon glyphicon-user"></span>
                学生学号
            </label>
            <div class="col-sm-8">
                <input type="text" class=" border-radius-2 padding-left-10px" data-height="28" data-width="310" required
                       id="StudentId" name="StudentId"
                       placeholder="学号">
                <button type="button" id="search-button" name="search-button" class=" btn btn-primary vertical-align-baseline">
                     <span class="glyphicon glyphicon-search "></span> 查询
                </button>
            </div>
        </div>
        <div class="form-group">
            <label for="Grade" class="col-sm-2 control-label">
                <span class="glyphicon glyphicon-object-align-bottom"></span>
                学生年级
            </label>
            <div class="col-sm-10">
                <input type="number" min="2015" class="form-control" required data-max-width="400"
                       id="Grade" name="Grade"
                       placeholder="学生年级">
            </div>
        </div>
        <div class="form-group">
            <label for="Name" class="col-sm-2 control-label">
                <span class="glyphicon glyphicon-zoom-in"></span>
                学生姓名
            </label>
            <div class="col-sm-10">
                <input type="text" class="form-control" data-max-width="400" id="Name" name="Name"
                       placeholder="学生姓名">
            </div>
        </div>
        <div class="form-group">
            <label for="Sex" class="col-sm-2 control-label">
                <span class="glyphicon glyphicon-font"></span>
                学生性别
            </label>
            <div class="col-sm-10">
                <select id="Sex" name="Sex" class="form-control" data-max-width="200">
                    <option value="true"> 男</option>
                    <option value="false"> 女</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label for="BirthDate" class="col-sm-2 control-label">
                <span class="glyphicon glyphicon-calendar"></span>
                出生日期
            </label>
            <div class="col-sm-10">
                <input type="date" class="form-control" id="BirthDate" name="BirthDate" data-max-width="200">
            </div>
        </div>
        <div class="form-group">
            <label for="Email" class="col-sm-2 control-label">
                <span class="glyphicon glyphicon-zoom-in"></span>
                电子邮箱
            </label>
            <div class="col-sm-10">
                <input type="email" required class="form-control" data-max-width="400"
                       name="Email" id="Email"
                       placeholder="QQ 邮箱">
                <span id="helpBlock2" class="help-block">请最好输入QQ邮箱！</span>
            </div>
        </div>
        <div class="form-group">
            <label for="StudentType" class="col-sm-2 control-label">
                <span class="glyphicon glyphicon-eye-close"></span>
                学生身份
            </label>
            <div class="col-sm-10">
                <select name="StudentType" id="StudentType" class="form-control" data-max-width="200">
                    <option value="0">本科生</option>
                    <option value="1">研究生</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label for="InstituteId" class="col-sm-2 control-label">
                <span class="glyphicon glyphicon-th-large"></span>
                所属学院
            </label>
            <div class="col-sm-10">
                <select name="InstituteId" id="InstituteId" class="form-control" data-max-width="200">

                </select>
            </div>
        </div>
        <div class="form-group">
            <label for="ProfessionId" class="col-sm-2 control-label">
                <span class="glyphicon glyphicon-eye-close"></span>
                所属专业
            </label>
            <div class="col-sm-10">
                <select name="ProfessionId" id="ProfessionId" class="form-control" data-max-width="200">

                </select>
            </div>
        </div>
        <div class="form-group">
            <label for="IDNumber" class="col-sm-2 control-label">
                <span class="glyphicon glyphicon-eye-close"></span>
                身份证号
            </label>
            <div class="col-sm-10">
                <input type="text" required class="form-control" id="IDNumber" name="IDNumber" data-max-width="400"
                       placeholder="身份证号">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">
                <span class="glyphicon glyphicon-lamp"></span>
                学生密码
            </label>
            <div class="col-sm-10">
                <p class="form-control-static">添加后学生具有默认密码身份证号后六位</p>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
                <button type="button" class="btn btn-success"> <span class="glyphicon glyphicon-send"></span> 返回页面 </button>
                <button type="submit" class="  margin-left-25px  btn btn-primary">  <span class="glyphicon glyphicon-floppy-saved"></span> 立即保存 </button>
            </div>
        </div>
    </form>
</div>
<script src="~/lib/validation/jquery.validate.min.js"></script>
<script src="~/lib/validation/additional-methods.min.js"></script>
<script src="~/lib/validation/messages_zh.js"></script>
<div class="modal fade" id="program" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title font-weight-400 font-size-14 padding-top-10px text-info">拼命加载数据中</h4>
            </div>
            <div class="modal-body">
                <span class=" glyphicon glyphicon-cloud-upload "></span> 
                <span id="data-info">拼命搬运数据中........</span>
            </div>
        </div>
    </div>
</div>
@section Scripts
{
    <script>
        (function loadInstitute() {
            $.ajax({
                url: "/Institute/List",
                type: "post",
                dataType: "json",
                success: function(data, textStatus, jqXHR) {
                    for (var index in data) {
                        $("#InstituteId")
                            .append(`<option value="${data[index].instituteId}">${data[index].name}</option>`);
                    }
                    loadProfession();
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    onMask("错误", errorThrown);
                }
            });
        })();

        $('#StudentType').change(function (jqEvent) {
            loadProfession();
        });

        function loadProfession() {
            var type = $('#StudentType').val();
            var id = $('#InstituteId').val();
            $.ajax({
                url: "/Profession/ListById",
                type: "post",
                dataType: "json",
                data: {
                    pid: id,
                    type:type
                },
                success: function (data, textStatus, jqXHR) {
                    $("#ProfessionId option").remove();

                    for (var index in data.professions) {
                        $("#ProfessionId")
                            .append(`<option value="${data.professions[index].id}">${data.professions[index].name}</option>`);
                    }
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    onMask("错误", errorThrown);
                }
            });
        }

        $('#InstituteId').change(function (jqEvent) {
            loadProfession();
        });

        $('#search-button').click(function () {
            if ($('#StudentId').val() == ""){
                onMask("提示信息", "请填写学号！");
                return;
            }
            $.ajax({
                url: "/Manager/IsExist",
                type: "post",
                dataType: "json",
                data: {
                    sId: $('#StudentId').val()
                },
                success: function (json, textStatus, jqXHR) {
                    if (json.isOk) {
                        onMask(json.title, json.message);
                    } else {
                        onMask(json.title, json.message);
                    }
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    onMask("错误", errorThrown);
                }
            });
        });

        $("form").validate({
            //错误提示信息
            messages: {
                StudentId: {
                    required: "学号不能为空",
                    minlength: "学号最小长度为{0}"
                },
                IDNumber: {
                    required: "请填写学生证号码",
                    rangelength: "身份证号为{0}位"
                },
                Name: {
                    required: "请填写名称",
                    maxlength: "名称长度请不要超过40位"
                },
                BirthDate: {
                    required: "请填写生日日期"
                },
                Grade: {
                    required: "请填写年级",
                    min: "最小年级为2015",
                    digits: "请填写整数",
                    number: "请填写数字"
                },
                Email: {
                    required: "请填写邮件",
                    email: "邮件格式不正确"
                }
            },
            //验证规则
            rules: {
                StudentId: {
                    required: true,
                    minlength: 10
                },
                IDNumber: {
                    required: true,
                    rangelength: [18, 18]
                },
                Name: {
                    required: true,
                    maxlength: 40
                },
                BirthDate: {
                    required: true
                },
                Grade: {
                    required: true,
                    min: 2015,
                    digits: true,
                    number: true
                },
                Email: {
                    required: true,
                    email: true
                }
            },
            errorClass: "text-primary",
            submitHandler: function(form) {
                var data_ = $(form).serialize();

                $('#program #data-info').text("拼命搬运数据中........！");
                $('#program').modal("show");

                $.ajax({
                    url: `/Manager/Create?${data_}`,
                    type: "post",
                    dataType: "json",
                    success: function(json, textStatus, jqXhr) {
                        if (json.isOk) {
                            $('#program #data-info').text("操作完成！");
                        } else {
                            $('#program #data-info').text(json.message);
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        onMask("错误", "网络连接失败...");
                    }
                });
            }
        });
    </script>
}
